From archiver@db.geocrawler.com Sun Jan 16 12:44:09 2000
Date: Sun, 16 Jan 2000 05:22:24 -0500
From: Can Leonard <archiver@db.geocrawler.com>
Reply-To: licq-devel@lists.sourceforge.net
To: licq-devel@lists.sourceforge.net
Subject: [Licq-devel] Installation notes for FreeBSD

This message was sent from Geocrawler.com by "Can Leonard" <ocl3@columbia.edu>
Be sure to reply to that address.

I'm not sure if this is the correct place for
this, but I'm hoping the essence of what I have to
say will work its way into the README files or
soemthing..

So, as probably known, licq-0.71+ does NOT work
out-of-the-box on FreeBSD (i'm talking 3.0+).
There is a hint somewhere on the main Licq page
that suggests people download the GNU Pth
package... get rid of that message. Gnu pth is a
cool idea but it certainly doesnt have what it
takes to do a successful build/run of licq (it is
unable to do "hard system call mapping" meaning
that the blocking system calls end up blocking the
whole program... hence responses on the network
are not read (you can see the buildup on the
recv-queue by using 'netstat'), so the program
appears to be useless).
That is to say, if someone knows what their doing,
they can get this far. The way configure does
things, it includes two threading libraries at
once (libc_r + libpthreads (GNU Pth)).. if it's
not already obvious, this does NOT work and core
dumps the thing within a second. 
So now that we've established that we dont want
GNU Pth, we need to use a real pthreads library...
libc_r.so.3 does not have pthread_cancel, but
libc_r.so.4 does... unfortunately I'm not sure if
the library can be downloaded as a binary from
anywhere.. you can get the source tree from 
ftp://ftp.freebsd.org/.2/FreeBSD/branches/3.0-stable/src/lib/libc_r.tar
which you must then extract into /usr/src/lib
(btw, you also need the source for libc, which can
be found at
/.2/FreeBSD/branches/3.0-stable/src/lib/libc.tar)
this should compile fine with the exception that
assert.c #include's <assert.h>... you need to
comment out that line ... i'll try to get the
FreeBSD people to fix it)
I hope i'm not losing people by now.. at least the
people who follow me so far will spend less time
trying to debug the problem :)
Ok, so now that you've compiled and installed
libc_r.so.4 (which has all threading functions
used in licq-0.75.1), you're almost ready.. 
the program core dumps while starting up (again,
within a second), and gdb talks about
pthread_mutes_init or something... that's really
not the problem.. the problem is libstdc++ (the
one that licq tries to link to by default), is
/usr/lib/libstdc++.so.2.1 (at least, it's like
that on my machine, which I built from source).. 
you dont want to link against that version, but
against /usr/local/lib/libstdc++.so.2.10.0
(if you dont have that installed on your system
fish around in the ports tree).. and how do you
get that to work? licq-0.75.1/src/Makefile needs
to be edited.. change the line that says 
LIBS = -lstdc++ -lc_r -lc_r
(essentially the line that starts with LIBS= blah)
to be
LIBS = -L/usr/local/lib -lstdc++ -lc_r -lc_r
(naturally, one of the -lc_r's is redundant, but
it doesnt seem to cause any problems)
once this is all accomplished, and you compile and
install it, you should have a working version of
licq.

Notes: This was only tested on FreeBSD3.4-RELEASE,
although I dont think it should be any different
on 3.x machines.. i cant say anything about 2.x.y
boxes.

So if you could make this information publicly
available, I'll try to get someone to add this to
the ports hierarchy....

Thanks,

Can Leonard
Columbia University


Geocrawler.com - The Knowledge Archive

_______________________________________________
Licq-devel mailing list
Licq-devel@licq.org
http://lists.sourceforge.net/mailman/listinfo/licq-devel
